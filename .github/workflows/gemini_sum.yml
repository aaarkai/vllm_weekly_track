# .github/workflows/weekly-summary.yml
name: Generate Upstream Weekly Summary

on:
  # Allow manual triggering of the workflow.
  workflow_dispatch:

  # Schedule to run every Friday at 23:00 UTC.
  schedule:
    - cron: "0 2 * * 5"

jobs:
  create-summary:
    runs-on: ubuntu-latest
    permissions:
      # Required to push a commit to the repository.
      contents: write

    steps:
      - name: 1. Checkout repository
        uses: actions/checkout@v4

      - name: 2. Set file path for summary
        id: file_details
        run: echo "filepath=summaries/weekly-$(date +'%Y-%m-%d').md" >> $GITHUB_ENV

      - name: 3. Generate weekly summary
        env:
          # Use the GITHUB_TOKEN provided by the runner.
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # The repository from which to fetch PRs.
          UPSTREAM_REPO: "vllm-project/vllm"
          # The target file path for the generated summary.
          TARGET_FILE: ${{ env.filepath }}
        run: |
          # Make the script executable
          chmod +x .github/scripts/generate-summary.sh
          # Run the script
          .github/scripts/generate-summary.sh

      - name: 4. Commit summary file
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: Add weekly summary for ${{ env.filepath }}"
          file_pattern: ${{ env.filepath }}
          commit_user_name: "GitHub Actions Bot"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
